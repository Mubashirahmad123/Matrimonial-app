{% block content %}
  <h1>Message History</h1>
  <ul>
    {% for message in messages %}
      <li>
        <strong>{{ message.sender.username }}:</strong> {{ message.message }}
      </li>
    {% endfor %}
  </ul>

  {% for message in messages %}
    {# Check if message.sender is not None before attempting to access attributes #}
    {% if message.sender %}
      {# Check if message.sender.id is a valid integer #}
      {% if message.sender.id %}
        <a href="{% url 'app:profile_detail' message.sender.id %}">Back to Profile</a>
        <a href="{% url 'app:send_message' message.sender.id %}">Compose a New Message</a>
      {% else %}
        {# Handle the case where message.sender.id is None or empty #}
        <p>Unable to generate profile-related URLs: User ID is missing or invalid for sender "{{ message.sender.username }}".</p>
      {% endif %}
    {% else %}
      {# Handle the case where message.sender is None #}
      <p>Unable to generate profile-related URLs: Sender information is missing for message "{{ message.message }}".</p>
    {% endif %}
  {% endfor %}
{% endblock %}
